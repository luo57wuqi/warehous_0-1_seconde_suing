# 数据库表设计详细文档

## 1. 概述

本文档提供采购管理系统数据库表的详细设计，包括每个表的字段定义、数据类型、约束条件、索引建议以及表与表之间的关系。本文档适用于系统开发人员和数据库管理员参考使用。

## 2. 表结构详细设计

### 2.1 用户表 (Users)

**用途**：存储系统所有用户的基本信息，包括内部用户和供应商用户。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | INT(11) | PRIMARY KEY, AUTO_INCREMENT | 用户唯一标识符 | 主索引 |
| username | VARCHAR(50) | NOT NULL, UNIQUE | 用户名，用于登录 | 唯一索引 |
| password | VARCHAR(255) | NOT NULL | 密码，加密存储 | 无 |
| email | VARCHAR(100) | NOT NULL, UNIQUE | 电子邮箱 | 唯一索引 |
| phone | VARCHAR(20) | | 电话号码 | 无 |
| user_type | ENUM('internal', 'supplier') | NOT NULL | 用户类型 | 普通索引 |
| department | VARCHAR(50) | | 部门（仅内部用户） | 普通索引 |
| supplier_id | INT(11) | | 所属供应商ID（仅供应商用户） | 外键索引 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 | 无 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | 无 |

**索引建议**：
- 为`username`和`email`创建唯一索引，确保登录凭据唯一性
- 为`user_type`和`department`创建普通索引，优化查询性能
- 为`supplier_id`创建外键索引，加速关联查询

**关系**：
- 与`Suppliers`表通过`supplier_id`字段建立一对多关系（一个供应商可有多个用户）
- 与`UserRoles`表通过`id`字段建立一对多关系
- 与`PurchaseOrders`表通过`id`字段（作为`created_by`和`approved_by`）建立一对多关系
- 与`ProductionProgress`表通过`id`字段（作为`updated_by`）建立一对多关系
- 与`LogisticsRecords`表通过`id`字段（作为`updated_by`）建立一对多关系
- 与`InventoryIn`表通过`id`字段（作为`received_by`）建立一对多关系

### 2.2 角色表 (Roles)

**用途**：存储系统用户角色信息，用于权限管理。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | INT(11) | PRIMARY KEY, AUTO_INCREMENT | 角色唯一标识符 | 主索引 |
| name | VARCHAR(50) | NOT NULL, UNIQUE | 角色名称 | 唯一索引 |
| description | TEXT | | 角色描述 | 无 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 | 无 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | 无 |

**索引建议**：
- 为`name`创建唯一索引，确保角色名称唯一性

**关系**：
- 与`UserRoles`表通过`id`字段建立一对多关系
- 与`RolePermissions`表通过`id`字段建立一对多关系

### 2.3 用户角色关联表 (UserRoles)

**用途**：实现用户与角色之间的多对多关系映射。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| user_id | INT(11) | PRIMARY KEY, FOREIGN KEY | 用户ID | 复合主键，外键索引 |
| role_id | INT(11) | PRIMARY KEY, FOREIGN KEY | 角色ID | 复合主键，外键索引 |

**索引建议**：
- 使用复合主键`(user_id, role_id)`，确保用户与角色的关联唯一性
- 为`user_id`和`role_id`分别创建外键索引

**关系**：
- 与`Users`表通过`user_id`字段建立多对一关系
- 与`Roles`表通过`role_id`字段建立多对一关系

### 2.4 权限表 (Permissions)

**用途**：存储系统所有权限项的信息。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | INT(11) | PRIMARY KEY, AUTO_INCREMENT | 权限唯一标识符 | 主索引 |
| name | VARCHAR(50) | NOT NULL, UNIQUE | 权限名称 | 唯一索引 |
| description | TEXT | | 权限描述 | 无 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 | 无 |

**索引建议**：
- 为`name`创建唯一索引，确保权限名称唯一性

**关系**：
- 与`RolePermissions`表通过`id`字段建立一对多关系

### 2.5 角色权限关联表 (RolePermissions)

**用途**：实现角色与权限之间的多对多关系映射。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| role_id | INT(11) | PRIMARY KEY, FOREIGN KEY | 角色ID | 复合主键，外键索引 |
| permission_id | INT(11) | PRIMARY KEY, FOREIGN KEY | 权限ID | 复合主键，外键索引 |

**索引建议**：
- 使用复合主键`(role_id, permission_id)`，确保角色与权限的关联唯一性
- 为`role_id`和`permission_id`分别创建外键索引

**关系**：
- 与`Roles`表通过`role_id`字段建立多对一关系
- 与`Permissions`表通过`permission_id`字段建立多对一关系

### 2.6 供应商表 (Suppliers)

**用途**：存储所有供应商的详细信息。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | INT(11) | PRIMARY KEY, AUTO_INCREMENT | 供应商唯一标识符 | 主索引 |
| name | VARCHAR(100) | NOT NULL | 供应商名称 | 普通索引 |
| contact_person | VARCHAR(50) | | 联系人 | 无 |
| contact_phone | VARCHAR(20) | | 联系电话 | 无 |
| contact_email | VARCHAR(100) | | 联系邮箱 | 无 |
| address | TEXT | | 地址 | 无 |
| status | ENUM('active', 'inactive') | DEFAULT 'active' | 状态（激活/非激活） | 普通索引 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 | 无 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | 无 |

**索引建议**：
- 为`name`创建普通索引，优化供应商查询
- 为`status`创建普通索引，优化按状态筛选

**关系**：
- 与`Users`表通过`id`字段建立一对多关系（一个供应商可有多个用户）
- 与`PurchaseOrders`表通过`id`字段建立一对多关系（一个供应商可处理多个订单）

### 2.7 商品表 (Products)

**用途**：存储所有可采购商品的信息。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | INT(11) | PRIMARY KEY, AUTO_INCREMENT | 商品唯一标识符 | 主索引 |
| name | VARCHAR(100) | NOT NULL | 商品名称 | 普通索引 |
| description | TEXT | | 商品描述 | 无 |
| category | VARCHAR(50) | | 商品分类 | 普通索引 |
| unit | VARCHAR(20) | | 计量单位 | 无 |
| specification | TEXT | | 商品规格 | 无 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 | 无 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | 无 |

**索引建议**：
- 为`name`和`category`创建普通索引，优化商品查询和分类筛选

**关系**：
- 与`PurchaseDetails`表通过`id`字段建立一对多关系（一个商品可出现在多个订单中）
- 与`Inventory`表通过`id`字段建立一对多关系（一个商品可有库存记录）
- 与`InventoryIn`表通过`id`字段建立一对多关系（一个商品可有多次入库记录）

### 2.8 采购单表 (PurchaseOrders)

**用途**：存储采购订单的基本信息和状态。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | INT(11) | PRIMARY KEY, AUTO_INCREMENT | 采购单唯一标识符 | 主索引 |
| order_no | VARCHAR(50) | NOT NULL, UNIQUE | 订单编号 | 唯一索引 |
| created_by | INT(11) | FOREIGN KEY | 创建人ID | 外键索引 |
| supplier_id | INT(11) | FOREIGN KEY | 供应商ID | 外键索引 |
| status | ENUM('pending', 'confirmed', 'in_production', 'shipping', 'received') | NOT NULL DEFAULT 'pending' | 订单状态 | 普通索引 |
| total_amount | DECIMAL(10,2) | DEFAULT 0 | 订单总金额 | 无 |
| expected_delivery_date | DATE | | 预计交货日期 | 普通索引 |
| actual_delivery_date | DATE | | 实际交货日期 | 普通索引 |
| approval_status | ENUM('pending', 'approved', 'rejected') | DEFAULT 'pending' | 审批状态 | 普通索引 |
| approved_by | INT(11) | FOREIGN KEY | 审批人ID | 外键索引 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 | 普通索引 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | 无 |

**索引建议**：
- 为`order_no`创建唯一索引，确保订单编号唯一性
- 为`created_by`、`supplier_id`、`status`、`approval_status`、`created_at`创建普通索引，优化查询性能
- 为`expected_delivery_date`和`actual_delivery_date`创建普通索引，优化日期范围查询

**关系**：
- 与`Users`表通过`created_by`和`approved_by`字段建立多对一关系
- 与`Suppliers`表通过`supplier_id`字段建立多对一关系
- 与`PurchaseDetails`表通过`id`字段建立一对多关系（一个订单可有多个商品明细）
- 与`ProductionProgress`表通过`id`字段建立一对多关系（一个订单可有多个生产进度记录）
- 与`LogisticsRecords`表通过`id`字段建立一对多关系（一个订单可有多个物流记录）
- 与`InventoryIn`表通过`id`字段建立一对多关系（一个订单可对应多次入库记录）

### 2.9 采购明细表 (PurchaseDetails)

**用途**：存储采购订单中的商品明细信息。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | INT(11) | PRIMARY KEY, AUTO_INCREMENT | 明细唯一标识符 | 主索引 |
| order_id | INT(11) | FOREIGN KEY | 所属订单ID | 外键索引 |
| product_id | INT(11) | FOREIGN KEY | 商品ID | 外键索引 |
| quantity | INT(11) | NOT NULL | 采购数量 | 无 |
| unit_price | DECIMAL(10,2) | NOT NULL | 单价 | 无 |
| amount | DECIMAL(10,2) | NOT NULL | 金额 | 无 |
| specification | TEXT | | 商品规格 | 无 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 | 无 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | 无 |

**索引建议**：
- 为`order_id`和`product_id`创建外键索引，加速关联查询

**关系**：
- 与`PurchaseOrders`表通过`order_id`字段建立多对一关系
- 与`Products`表通过`product_id`字段建立多对一关系

### 2.10 生产进度表 (ProductionProgress)

**用途**：存储采购订单的生产进度记录。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | INT(11) | PRIMARY KEY, AUTO_INCREMENT | 生产进度记录唯一标识符 | 主索引 |
| order_id | INT(11) | FOREIGN KEY | 所属订单ID | 外键索引 |
| progress_percentage | INT(11) | NOT NULL | 生产进度百分比 | 无 |
| description | TEXT | | 进度描述 | 无 |
| updated_by | INT(11) | FOREIGN KEY | 更新人ID | 外键索引 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 | 普通索引 |

**索引建议**：
- 为`order_id`和`updated_by`创建外键索引，加速关联查询
- 为`created_at`创建普通索引，优化时间顺序查询

**关系**：
- 与`PurchaseOrders`表通过`order_id`字段建立多对一关系
- 与`Users`表通过`updated_by`字段建立多对一关系

### 2.11 物流记录表 (LogisticsRecords)

**用途**：存储采购订单的物流跟踪记录。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | INT(11) | PRIMARY KEY, AUTO_INCREMENT | 物流记录唯一标识符 | 主索引 |
| order_id | INT(11) | FOREIGN KEY | 所属订单ID | 外键索引 |
| location | VARCHAR(100) | NOT NULL | 物流位置 | 无 |
| status | VARCHAR(50) | NOT NULL | 物流状态 | 普通索引 |
| description | TEXT | | 物流描述 | 无 |
| updated_by | INT(11) | FOREIGN KEY | 更新人ID | 外键索引 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 | 普通索引 |

**索引建议**：
- 为`order_id`和`updated_by`创建外键索引，加速关联查询
- 为`status`和`created_at`创建普通索引，优化状态筛选和时间顺序查询

**关系**：
- 与`PurchaseOrders`表通过`order_id`字段建立多对一关系
- 与`Users`表通过`updated_by`字段建立多对一关系

### 2.12 库存表 (Inventory)

**用途**：存储商品的当前库存信息。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | INT(11) | PRIMARY KEY, AUTO_INCREMENT | 库存记录唯一标识符 | 主索引 |
| product_id | INT(11) | FOREIGN KEY | 商品ID | 外键索引 |
| quantity | INT(11) | NOT NULL DEFAULT 0 | 当前库存数量 | 无 |
| warehouse | VARCHAR(50) | | 仓库 | 普通索引 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 | 无 |

**索引建议**：
- 为`product_id`创建外键索引，加速关联查询
- 为`warehouse`创建普通索引，优化仓库筛选

**关系**：
- 与`Products`表通过`product_id`字段建立多对一关系

### 2.13 入库记录表 (InventoryIn)

**用途**：存储商品的入库记录。

| 字段名 | 数据类型 | 约束 | 描述 | 索引 |
|-------|---------|------|------|------|
| id | INT(11) | PRIMARY KEY, AUTO_INCREMENT | 入库记录唯一标识符 | 主索引 |
| order_id | INT(11) | FOREIGN KEY | 所属订单ID | 外键索引 |
| product_id | INT(11) | FOREIGN KEY | 商品ID | 外键索引 |
| quantity | INT(11) | NOT NULL | 入库数量 | 无 |
| unit_price | DECIMAL(10,2) | | 入库单价 | 无 |
| total_amount | DECIMAL(10,2) | | 入库总金额 | 无 |
| warehouse | VARCHAR(50) | | 入库仓库 | 普通索引 |
| received_by | INT(11) | FOREIGN KEY | 收货人ID | 外键索引 |
| received_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 入库时间 | 普通索引 |

**索引建议**：
- 为`order_id`、`product_id`和`received_by`创建外键索引，加速关联查询
- 为`warehouse`和`received_at`创建普通索引，优化仓库筛选和时间顺序查询

**关系**：
- 与`PurchaseOrders`表通过`order_id`字段建立多对一关系
- 与`Products`表通过`product_id`字段建立多对一关系
- 与`Users`表通过`received_by`字段建立多对一关系

## 3. 数据库关系图 (ER图)

```
+-------------+
|   Users     |
+-------------+
| id          | 1..N     1..N |
| username    |-------------| 1..N
| password    | |         | |
| email       | |         | |
| user_type   | |         | |
| supplier_id | |         | |
| created_at  | |         | |
| updated_at  | |         | |
+-------------+ |         | |
                |         | |
                v         v v
+-------------+ 1..N 1..N +-------------+
|  Suppliers  |<----------|PurchaseOrders|----1..N----+   
+-------------+           +-------------+            |   
| id          |           | id          |            |   
| name        |           | order_no    |            |   
| contact_person|         | created_by  |            |   
| contact_phone|         | supplier_id |            |   
| contact_email|         | status      |            |   
| address     |         | total_amount|            |   
| status      |         | created_at  |            |   
| created_at  |         | updated_at  |            |   
| updated_at  |         +-------------+            |   
+-------------+                  |                 |   
                                 |                 |   
                                 v                 v   
                     +-------------+     +-------------+
                     |PurchaseDetails|     |ProductionProgress|
                     +-------------+     +-------------+
                     | id          |     | id          |
                     | order_id    |     | order_id    |
                     | product_id  |     | progress_percentage|
                     | quantity    |     | description |
                     | unit_price  |     | updated_by  |
                     | amount      |     | created_at  |
                     +-------------+     +-------------+
                           |
                           v
                     +-------------+
                     |   Products  |
                     +-------------+
                     | id          |
                     | name        |
                     | description |
                     | category    |
                     | unit        |
                     | specification|
                     +-------------+
                           |
                           v
                     +-------------+
                     |  Inventory  |
                     +-------------+
                     | id          |
                     | product_id  |
                     | quantity    |
                     | warehouse   |
                     | updated_at  |
                     +-------------+

+-------------+ 1..N 1..N +-------------+
|  InventoryIn|<----------|PurchaseOrders|----1..N----+   
+-------------+           +-------------+            |   
| id          |                                      |   
| order_id    |                                      |   
| product_id  |                                      |   
| quantity    |                                      |   
| unit_price  |                                      |   
| total_amount|                                      |   
| warehouse   |                                      |   
| received_by |                                      |   
| received_at |                                      |   
+-------------+                                      |   
                                                     |   
                                                     v   
                                               +-------------+
                                               |LogisticsRecords|
                                               +-------------+
                                               | id          |
                                               | order_id    |
                                               | location    |
                                               | status      |
                                               | description |
                                               | updated_by  |
                                               | created_at  |
                                               +-------------+

+-------------+ 1..N 1..N +-------------+
|    Roles    |<----------|  UserRoles  |---------->1..N+-------------+
+-------------+           +-------------+                |   Users     |
| id          |                                          +-------------+
| name        |
| description |
| created_at  |
| updated_at  |
+-------------+
      |
      v
+-------------+ 1..N 1..N +-------------+
|Permissions  |<----------|RolePermissions|---------->1..N+-------------+
+-------------+           +-------------+                |    Roles    |
| id          |                                          +-------------+
| name        |
| description |
| created_at  |
+-------------+
```

## 4. 数据约束与完整性

### 4.1 实体完整性
- 所有表的主键字段都不能为空且具有唯一性
- 外键字段必须引用关联表中存在的主键值

### 4.2 域完整性
- 使用适当的数据类型和长度限制字段值的范围
- 通过NOT NULL约束确保必要字段的值不为空
- 使用UNIQUE约束确保字段值的唯一性
- 使用CHECK约束（在MySQL中通过ENUM类型实现）限制字段值的可选范围

### 4.3 参照完整性
- 所有外键约束确保了表与表之间的参照完整性
- 在删除或更新主表记录时，应根据业务需求设置相应的级联操作（CASCADE、SET NULL等）

### 4.4 自定义完整性规则
- 用户密码必须进行加密存储
- 采购订单状态流转应遵循业务逻辑
- 供应商用户只能关联一个供应商

## 5. 性能优化建议

### 5.1 索引优化
- 为常用查询的WHERE条件、JOIN条件和ORDER BY子句中的字段创建索引
- 避免在频繁更新的字段上创建索引
- 定期分析和重建索引，保持索引的高效性

### 5.2 查询优化
- 避免使用SELECT *，而是指定所需的字段
- 合理使用连接（JOIN）操作，避免不必要的表连接
- 对于复杂查询，考虑使用视图或存储过程
- 使用EXPLAIN分析查询执行计划，识别性能瓶颈

### 5.3 数据库配置优化
- 根据实际负载调整MySQL的缓冲区大小、连接数等参数
- 配置适当的日志级别和存储位置
- 启用查询缓存（在适当时）

## 6. 安全策略

### 6.1 访问控制
- 实施严格的用户认证和授权机制
- 为不同类型的用户分配不同的数据库访问权限
- 定期审核用户权限和访问日志

### 6.2 数据加密
- 对敏感数据（如密码）进行加密存储
- 考虑使用SSL/TLS加密数据传输
- 对于高度敏感的数据，可以考虑使用透明数据加密（TDE）

### 6.3 备份与恢复
- 制定完善的数据备份策略，包括定期全量备份和增量备份
- 测试数据恢复流程，确保备份数据的可用性
- 存储备份数据的安全位置，防止数据丢失

## 7. SQLite与MySQL差异说明

### 7.1 数据类型映射
- SQLite INTEGER -> MySQL INT
- SQLite TEXT -> MySQL VARCHAR/TEXT
- SQLite REAL -> MySQL DECIMAL/FLOAT
- SQLite TIMESTAMP -> MySQL TIMESTAMP

### 7.2 约束差异
- SQLite支持外键约束，但默认情况下是关闭的，需要手动启用
- MySQL的ENUM类型提供了更严格的值范围限制
- MySQL支持ON DELETE和ON UPDATE级联操作，而SQLite的支持有限

### 7.3 索引差异
- MySQL支持多种索引类型（BTREE、FULLTEXT等）
- SQLite主要使用BTREE索引
- MySQL提供了更多的索引优化选项

## 8. 迁移指南

### 8.1 从SQLite到MySQL的迁移步骤
1. 在MySQL中创建相应的数据库和表结构
2. 从SQLite导出数据为CSV格式
3. 使用MySQL的LOAD DATA INFILE命令导入数据
4. 验证数据完整性和一致性
5. 修改应用配置，指向MySQL数据库

### 8.2 迁移注意事项
- 确保在迁移过程中系统处于离线状态或只读模式
- 备份所有数据，以防迁移失败
- 测试迁移后的数据，确保与预期一致
- 考虑使用专业的数据库迁移工具，如SQLyog、Navicat等

---

文档版本：v1.0
文档更新日期：2023-XX-XX