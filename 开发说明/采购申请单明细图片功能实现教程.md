# 采购申请单明细图片功能实现教程

## 1. 功能介绍
本教程将指导您如何在采购管理系统中为采购申请单明细模块添加货品图片显示功能。通过本教程，您将学会：
- 如何为Mock数据添加图片信息
- 如何在页面中显示图片并实现预览功能
- 如何处理无图片的情况
- 如何扩展此功能

## 2. 准备工作

### 2.1 环境要求
- 已安装Node.js和npm
- 已克隆采购管理系统项目代码
- 已完成项目依赖安装（执行过`npm install`）

### 2.2 相关文件位置
- Mock数据文件：`mock/purchaseRequest.js`
- 采购申请单明细页面：`src/views/purchase-request/detail/index.vue`

## 3. 实现步骤

### 3.1 步骤一：为Mock数据添加图片信息

1. 打开`mock/purchaseRequest.js`文件
2. 在每个采购申请单的`items`数组中，为每个物品对象添加`imageUrl`字段
3. 为`imageUrl`字段赋值Base64格式的图片数据

**示例代码：**

```javascript
// 修改 mock/purchaseRequest.js 文件
const Mock = require('mockjs')

// 模拟采购申请单数据
const purchaseRequests = Mock.mock({
  'list|10': [
    {
      'id|+1': 1,
      'code': /[A-Z]\d{7}/,
      'applicant': '@cname',
      'department': '@ctitle(4,6)',
      'totalAmount|1000-10000.2': 1,
      'status|1': ['pending', 'approved', 'rejected', 'purchased'],
      'createTime': '@datetime',
      'items|1-5': [
        {
          'id|+1': 1,
          'goodsCode|1': ['P001', 'P002', 'P003', 'P004', 'P005'],
          'goodsName|1': ['办公椅', '笔记本电脑', '打印机', '文件夹', '订书机'],
          'specification|1': ['黑色', '银色', '蓝色', 'A4', '标准型'],
          'unit|1': ['把', '台', '个', '箱', '包'],
          'quantity|1-10': 1,
          'price|10-1000.2': 1,
          'amount|1-10000.2': 1,
          // 添加imageUrl字段，包含Base64格式图片数据
          'imageUrl': 'data:image/png;base64,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'
        }
      ]
    }
  ]
})

module.exports = [
  // 查询采购申请单列表
  {
    url: '/vue-admin-template/purchase-request/list',
    type: 'get',
    response: config => {
      const list = purchaseRequests.list
      return {
        code: 20000,
        data: {
          total: list.length,
          items: list
        }
      }
    }
  },
  // 其他API配置...
]
```

> **提示**：您可以使用在线工具将图片转换为Base64格式，例如 [Base64 Image Encoder](https://www.base64-image.de/)

### 3.2 步骤二：更新采购申请单明细页面

1. 打开`src/views/purchase-request/detail/index.vue`文件
2. 在表格列定义中，找到货品代码列和货品名称列
3. 在这两列之间添加货品图片列
4. 使用`<el-image>`组件显示图片，并实现预览功能
5. 添加条件渲染，处理无图片的情况

**示例代码：**

```vue
<template>
  <div class="app-container">
    <el-card>
      <template slot="header">
        <span>采购申请单详情</span>
      </template>
      <!-- 采购申请单基本信息 -->
      <div class="basic-info">
        <!-- 基本信息内容 -->
      </div>
      
      <!-- 货品列表 -->
      <el-table :data="purchaseRequest.items" border style="width: 100%">
        <el-table-column type="index" label="序号" width="50" />
        <el-table-column prop="goodsCode" label="货品代码" width="100" />
        
        <!-- 添加货品图片列 -->
        <el-table-column label="货品图片" width="120">
          <template slot-scope="scope">
            <el-image
              v-if="scope.row.imageUrl"
              :src="scope.row.imageUrl"
              :preview-src-list="[scope.row.imageUrl]"
              fit="cover"
              style="width: 80px; height: 80px;"
            />
            <span v-else>暂无图片</span>
          </template>
        </el-table-column>
        
        <el-table-column prop="goodsName" label="货品名称" />
        <el-table-column prop="specification" label="规格型号" />
        <el-table-column prop="unit" label="单位" width="80" />
        <el-table-column prop="quantity" label="数量" width="80" />
        <el-table-column prop="price" label="单价" width="100" />
        <el-table-column prop="amount" label="金额" width="100" />
      </el-table>
    </el-card>
  </div>
</template>

<script>
export default {
  name: 'PurchaseRequestDetail',
  data() {
    return {
      purchaseRequest: {}
    }
  },
  created() {
    this.getPurchaseRequestDetail()
  },
  methods: {
    getPurchaseRequestDetail() {
      // 获取采购申请单详情数据
      // 示例代码：
      this.axios.get('/vue-admin-template/purchase-request/detail', {
        params: {
          id: this.$route.query.id
        }
      }).then(response => {
        this.purchaseRequest = response.data
      })
    }
  }
}
</script>

<style scoped>
.basic-info {
  margin-bottom: 20px;
}
</style>
```

### 3.3 步骤三：验证功能

1. 保存所有修改的文件
2. 在项目根目录执行以下命令启动开发服务器：

```bash
npm run dev
```

3. 打开浏览器，访问系统页面
4. 导航到采购申请单列表页面
5. 点击任意采购申请单的"查看"按钮
6. 在采购申请单明细页面，检查货品列表中是否正确显示了图片
7. 点击图片，验证预览功能是否正常工作
8. 检查无图片的货品是否显示"暂无图片"提示文本

## 4. 功能扩展

### 4.1 图片上传功能
要为采购申请单添加图片上传功能，您可以按照以下步骤操作：

1. 在采购申请单编辑页面添加图片上传组件
2. 实现图片上传到服务器的逻辑
3. 在后端保存图片并返回图片URL
4. 将图片URL保存到采购申请单的物品信息中

**示例代码（上传组件）：**

```vue
<el-upload
  class="avatar-uploader"
  action="/api/upload"
  :show-file-list="false"
  :on-success="handleUploadSuccess"
  :before-upload="beforeAvatarUpload">
  <img v-if="imageUrl" :src="imageUrl" class="avatar">
  <i v-else class="el-icon-plus avatar-uploader-icon"></i>
</el-upload>

<script>
export default {
  data() {
    return {
      imageUrl: ''
    }
  },
  methods: {
    handleUploadSuccess(res, file) {
      this.imageUrl = res.data.url
    },
    beforeAvatarUpload(file) {
      const isPNG = file.type === 'image/png'
      const isLt2M = file.size / 1024 / 1024 < 2

      if (!isPNG) {
        this.$message.error('上传图片只能是 PNG 格式!')
      }
      if (!isLt2M) {
        this.$message.error('上传图片大小不能超过 2MB!')
      }
      return isPNG && isLt2M
    }
  }
}
</script>

<style>
.avatar-uploader .el-upload {
  border: 1px dashed #d9d9d9;
  border-radius: 6px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}
.avatar-uploader .el-upload:hover {
  border-color: #409EFF;
}
.avatar-uploader-icon {
  font-size: 28px;
  color: #8c939d;
  width: 80px;
  height: 80px;
  line-height: 80px;
  text-align: center;
}
.avatar {
  width: 80px;
  height: 80px;
  display: block;
}
</style>
```

### 4.2 图片懒加载
对于包含大量图片的页面，可以实现图片懒加载以提高性能：

1. 安装Element UI的懒加载插件
2. 在main.js中注册插件
3. 修改图片组件，添加懒加载属性

### 4.3 实际生产环境的图片存储
在实际生产环境中，建议将图片存储在专门的文件服务器或云存储服务中，而不是直接存储Base64编码：

1. 设置专门的文件存储服务（如阿里云OSS、七牛云等）
2. 修改后端API，实现图片上传和访问功能
3. 修改前端代码，使用图片URL而非Base64编码

## 5. 常见问题与解决方案

### 5.1 图片显示不出来
- 检查Base64编码格式是否正确
- 确认`imageUrl`字段名称与后端返回的字段名称一致
- 检查浏览器控制台是否有错误信息

### 5.2 图片预览功能不工作
- 确保`preview-src-list`属性设置正确
- 检查是否引入了Element UI的图片预览样式
- 确认图片路径可访问

### 5.3 页面加载缓慢
- 优化图片大小和质量
- 实现图片懒加载
- 考虑使用CDN加速图片访问

## 6. 总结
通过本教程，您已经学会了如何为采购申请单明细模块添加图片显示功能。这个功能可以显著提高系统的用户体验，使用户能够更直观地了解采购物品的信息。在实际项目中，您可以根据需求进一步扩展此功能，如添加图片上传、优化图片加载性能等。